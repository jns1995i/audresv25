<% layout('template') %>
<style>
  @media (max-width: 900px) {
    .reqPlate {
      flex-direction: column !important;
      gap: 2px;
      position: relative;
    }
    .reqPlate > div {
      width: 100%;
      justify-content: start;
      height: auto;
    }
    #helpCard {
      flex-direction: column-reverse;
      margin-bottom: 50px;
    }
    #homePg {
      margin-bottom: 50px;
    }
    .mainCard {
      width: 100%;
    }
    #vidCard {
      display: none;
    }
    .trP {
      display: none;
    }
    .dateP {
      font-size: 10px;
    }
  }
</style>



<div class="height0 padding5 alignStart hidden" id="homePg">
  <div class="height0 padding10 col mainCard width40 corner15" id="helpCard">
    <div class="height0 col padding20" id="headF">
        <div class="corner500 h80 w80 liquid borderWhite logoF glowImg3">
            <img src="/images/au.png" alt="" class="logo corner500 height80 bgWhite opacity7">
        </div>
        <p class="rem22 gradientText textWrap textCenter glowImg3 p1">AU Registrar Document</p>
        <p class="rem22 gradientText textWrap textCenter glowImg3 p2" style="margin-top: -1.6rem !important;">Request System</p>
    </div>
    <section class="corner10 col">
      <p class="textCenter"><i class="fas fa-phone"></i> <%= seedUser.phone %> &nbsp; | &nbsp; <i class="fas fa-envelope"></i> <%= seedUser.email %></p>
    </section>
    <div class="height0 padding10 gap10 width100 justifyStart bgWhite corner10 col">
        <a href="#" class="nav cnav disabled opacity0 absolute right5 bottom5 scale4"><i class="fas fa-question-circle"></i></a>
        <div class="height0 padding10 border0 borderRadius10 justifyBetween width100 gap10 relative corner15">
            <p class="rem16 gap10 alignCenter">Need Help?</p>
            <a href="/ins2" class="nav glass colorPrimary">Learn more here <i class="fas fa-chevron-right"></i></a>
        </div>
        <video autoplay muted loop playsinline controls class="width100 cornerRem1" id="vidCard" style="opacity: 1;"><source src="/images/video.mp4" type="video/mp4"></video>
    </div>
  </div>
  <div class="height0 padding10 col mainCard width60" style="z-index: 10;">
    <br><br>
    <section class="col glass alignStart padding15 relative gap10">

    <img src="/images/au.png" alt="" class="absolute h100 w100 bgWhite corner500 hidden" style="opacity: 0.05; filter: grayscale(0.9); z-index: 0; bottom: -20px; left: -20px; transform: scale(1.8);" id="watermark">
      <section class="col alignStart relative padding0">
        <p class="rem2">Hi, <%= user.fName %></p>
        <p class="rem1 str400">Requesting your documents made easy!</p>
      </section>
      <a href="/req" class="nav"><i class="fas fa-plus"></i> Start a new request</a>
      <div class="height0 liquid shadow2 width0 padding5 gap5 absolute right10 top10" style="border-radius: 30px;">
        <a href="/req" class="nav cnav liquid hidden"><i class="fas fa-bell"></i></a>
        <a href="/prf" class="nav cnav">
          <img src="<%= user.photo ? user.photo : '/images/profile.png' %>" alt="Profile" onerror="this.onerror=null; this.src='/images/profile.png';" class="borderPrimary">
        </a>
      </div>
    </section>
    <br>
    <section class="col padding10 bgWhite corner10">
      <section class="bgYellow corner10 col relative darkGray width99">
        <i class="fas fa-thumbtack absolute right15 top10 size14" style="transform: rotate(45deg);"></i>
        <p class="rem11 str500 textCenter width90">Take Note: Please be informed that document requests are only accepted from MONDAY to FRIDAY, between 8:00am to 5:00pm. Requests submitted beyond these hours will be processed on the next working day.</p>
      </section>
      <div class="height0 justifyBetween padding10">
        <p class="rem18 str400">Your Recent Request</p>
        <% if (requests && requests.length > 0) { %>
        <a href="/reqAll" class="rem16 paddingLeft10 str500">See All</a>
        <% } %>
      </div>
      <% if (requests && requests.length > 0) { %>
        <div class="height0 cornerRem1 colorPrimary padding0 shadow1 gap5 col">
          <% requests.slice(0, 3).forEach(req => { %>
            <a href="/reqView/<%= req._id %>" class="width100 shadow1">
              <div class="height0 padding15 bgWhite reqPlate">
                <div class="height0 justifyStart width20 trP">
                  <p class="size12 str600">TR# <%= req.tr %></p>
                </div>
                <div class="height0 alignStart width35 col">
                     <% if (req.items && req.items.length > 0) { %>
                      <% req.items.forEach(item => { %>
                        <p class="size12 str500"><%= item.qty %> <%= item.type %></p>
                      <% }) %>
                    <% } else { %>
                      <p class="text-muted str500">No items found for this request.</p>
                    <% } %>
                </div>
                <span class="height0 justifyStart w0 absolute right15 top15">
                  <%
                  function formatCustomDate(dateString) {
                    const d = new Date(dateString);
                    const now = new Date();

                    const oneDay = 24 * 60 * 60 * 1000;
                    const diffDays = Math.floor((now - d) / oneDay);

                    // Today
                    if (diffDays === 0) return "Today";

                    // Yesterday
                    if (diffDays === 1) return "Yesterday";

                    // Format month + day
                    const options = { month: "short", day: "numeric" };
                    let formatted = d.toLocaleDateString("en-US", options);

                    // Add year if not current year
                    if (d.getFullYear() !== now.getFullYear()) {
                      formatted += ", " + d.getFullYear();
                    }

                    return formatted;
                  }
                %>
                  <p class="size12 darkGray"><%= formatCustomDate(req.createdAt) %></p>
                </span>
                <div class="height0 width25 justifyEnd">
                    <% if ( req.holdAt ) { %>
                        <div class="size12 str400 padding0 cornerRem1 str500 width0 statIcon bgRed100"  style="background-color: transparent;">
                            On Hold
                        </div>
                    <% } else if ( req.declineAt ) { %>
                        <div class="size12 str400 padding0 cornerRem1 str500 width0 statIcon bgRed100 border0"  style="background-color: transparent;">
                            Declined
                        </div>
                    <% } else { %>
                        <div class="size12 str400 padding0 cornerRem1 str500 width0 statIcon
                        <% if ( req.status === "Pending" ) { %>
                            bgBlue100
                        <% } else if ( req.status === "Reviewed" ) { %>
                            bgViolet100
                        <% } else if ( req.status === "Assessed" ) { %>
                            bgYellow100
                        <% } else if ( req.status === "Verified" ) { %>
                            bgGreen100
                        <% } else if ( req.status === "For Release" ) { %>
                            bgGreen100
                        <% } else if ( req.status === "Claimed" ) { %>
                            bgGray100
                        <% } else { %>
                            bgBlue100
                        <% } %> border0
                        " style="background-color: transparent;">
                            <i class="fas fa-hourglass inline rem1 w15 h15 hidden"></i>
                            <%= req.status %>
                        </div>
                    <% } %>
                </div>
              </div>
            </a>
          <% }) %>
        </div>
      <% } else { %>
        <div class="height0 bgSoft corner14 colorPrimary padding20 gap10 col">
          <p class="rem16">You have no requests yet!</p>
        </div>
      <% } %>
    </section>
  </div>
</div>

